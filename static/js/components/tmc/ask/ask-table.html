@@@ tmc/ask/table

<div ng-hide="!$ctrl.cancelerHttp" ng-include=" 'progress/load' "></div>

<!--tmc-ask-form ng-if="$ctrl.ready"  data-param="$ctrl.param"></tmc-ask-form-->

<div class="show-on-ready z-depth-3" style="/*max-height: 50vh; overflow-y: auto;*/">

<h3 ng-show="$ctrl.param.title" class="center border-bottom" ng-class=" $ctrl.param.theadClass ">{{ $ctrl.param.title }}</h3>
<!--- таблица для необработанных заявок ТМЦ + простые поставки построчно -->
<!--div class="table-scroll-outer"><div class="table-scroll-inner"-->
<table class="top000 striped bordered " ng-class=" $ctrl.param.theadClass " ng-class-000="{'highlight-maroon-lighten-4': !!$ctrl.param['список простых закупок'], 'highlight-orange-lighten-4': !!$ctrl.param['в закупку']}">
  <thead><tr><!--th>#</th-->
    <th class="center" style="width:1%;">
      <h4 class="fw500">
        <a href="javascript:" data-target="date-select000">
          <span>На дату</span>
        </a>
      </h4>
      <div ng-if="$ctrl.param.where['дата1'].ready">
       <span ng-repeat="v in $ctrl.param.where['дата1']['формат'] track by $index" class="breadcrumb00 chip green-text">{{v}}</span>
      </div>
      <div class="left-align">
        <a ng-click=" $ctrl.param.where['дата1']['обратно сортировать'] = $ctrl['обратно сортировать'] = !$ctrl.param.where['дата1']['обратно сортировать'] " class="btn-flat" href="javascript:" title="порядок сортировки"><i class="material-icons fs20" ng-class="{'flip180': !$ctrl.param.where['дата1']['обратно сортировать']}">sort</i></a>
      </div>
    </th>
    

    
    <!--th ng-if="$ctrl.param.move.id === 0 || $ctrl.param.move.id == 1" ng-class="{'light-green lighten-4': $ctrl.param.move.id === 0}">
      <h4><a href="javascript:" data-target="contragent-select" class="green-text text-darken-2">
        <i class="material-icons">business</i>
        <span>Контрагент</span>
      </a></h4>
      <div ng-if="$ctrl.param.where['контрагент'].ready && $ctrl.param.where['контрагент'].id">
       <span class="chip green-text">{{$ctrl.param.where['контрагент'].title}}</span>
      </div>
      
    </th-->
    
    <th class="center" style="min-width:50%;">
      <h4 class="fw500"><a href="javascript:" data-target="nomen-select" class000="green-text text-darken-2">
        <!--i class="material-icons">business</i-->
        <span>Наименование</span>
      </a></h4>
      <div ng-if="$ctrl.param.where['наименование'].ready && $ctrl.param.where['наименование'].title">
          <svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="maroon-fill" style="height: 2rem;" ng-include=" 'svg/filter' " />
          <span class="chip maroon-text maroon lighten-5">{{$ctrl.param.where['наименование'].title}}</span>
      </div>
      
    </th>
    
    <th class="center" style="width:1%;">
      <h4 class="fw500">
        <!--i class="material-icons">more_horiz</i-->
        <span class="nowrap">Кол-во</span>
        <span ng-hide=" !$ctrl.param['список простых закупок'] "><br>заявки</span>
      </h4>
      <!--div ng-show=" !$ctrl.param['список простых закупок'] "><span class="bold">еще</span> <span class="chip grey-text">всего</span> </div-->
      
    </th>
    
    <!--th>
      <h4>
        <span>Ед</span>
      </h4>
    </th-->
    
    <!--th ng-if="$ctrl.param['объект'].id === 0" class="center" style="width:20%;">
      <h4 class="fw500">На объект, заказал</h4>
    
    </th-->
    
    <th class="center" style="min-width:20%;">
      <h4 class="fw500">
        <!--i class="material-icons">message</i-->
        <span>Примечание</span>
      </h4>
    </th>
    
    <th ng-if=" !!$ctrl.param['в закупку'] && !$ctrl.param['список простых закупок'] " class="center vbottom" style="width:1%;">
      <h5 class="fw500"><i class="icon icon-star fs20"></i> закупка</h5>
    </th>
    
    <th ng-if=" !!$ctrl.param['в закупку'] && !$ctrl.param['список простых закупок'] " class="center vbottom" style="width:1%;">
      <h5 class="fw500 maroon-text text-darken-3" title="простая закупка">
        <i class="icon icon-ok-circle fs20"></i>
        проще
      </h5>
    </th>
    
    <!--th ng-if=" !!$ctrl.param['в перемещение'] && !$ctrl.param['список простых закупок'] " class="center vbottom" style="width:1%;">
      <h5 class="fw500 red-text text-darken-3" title="простая поставка">
        <svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="rotate90left red-fill fill-darken-3" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#2arrows-180vert"></use></svg>
        перемещение</h5>
    </th-->
    
    <th ng-if=" !!$ctrl.param['список простых закупок'] " class="vbottom" style="min-width:25%;">
      <h4 class="fw500 maroon-text text-darken-3" title="сразу списание">Простая закупка</h4>
    </th>

    
    </tr></thead>
  
  <tbody ng-class-000=" $ctrl.param.tbodyClass " class=""><!-- | filter: $ctrl.FilterData | orderBy: $ctrl.OrderByData : !!$ctrl.param['список простых закупок'] -->
    <tr ng-repeat="ask in $ctrl.data | filter: $ctrl.FilterData | orderBy: $ctrl.OrderByData : $ctrl['обратно сортировать'] " ng-init="$ctrl.InitRow(ask)"  ng-attr-id="{{ask.id}}" class="relative" ng-class="{'selected': ask['обработка'] || it === $ctrl.param.edit || ask._edit}" ng-style-000="1 ? {'cursor': 'pointer'} : {}" title000="{000{it | json}}">
      <td class="right-align nowrap" title="{{ ask['дата1 краткий формат'] || ask['дата1'] }}">
          <span class="fs8"><span class=""> {{ ask['$дата1']['день нед'] }} </span>    <span class="bold"> {{ ask['$дата1']['day'] }} </span>   <span class="fs8"> {{ ask['$дата1']['мес'] }} </span> </span>
        <br ng-if="$ctrl.param['объект'].id === 0 || $ctrl.param['список простых закупок'] || ask['номенклатура/id']">
        <span class="fs8 grey-text chip"><span class=""> {{ ask['$ts']['день нед'] }} </span>    <span class=""> {{ ask['$ts']['day'] }} </span>   <span class=""> {{ ask['$ts']['мес'] }} </span></span>
      </td>

      <td class="right-align-000 padd-05">
        
          <h5 ng-hide-000="ask['$номенклатура']" class="fw500">
            <a ng-click="$ctrl.ClickAsk(ask)" ng-click-000="ask._edit = true;" href="javascript:" class="hover-shadow3d">
              <span ng-if=" !ask['$номенклатура'] && ask['номенклатура'] && ask['номенклатура'].pop " ng-repeat="n in ask['номенклатура'] track by $index" class="breadcrumb teal-text"><span class="chip shadow-inset-10 padd-0-05-000 border000">{{n}}</span></span>
              <span ng-class-000="{'fs8 grey-text-000': !!ask['номенклатура/id'] }"><br ng-if="!!ask['номенклатура/id']">{{ ask['наименование'] }}</span><!-- вместо позиции номенклатуры -->
            </a>
          </h5>
          
          <div ng-if=" ask['$номенклатура'] ">
            <tree-item  ng-init-000=" param = " data-param=" {'placeholder':'позиция номенклатуры и запросить остатки', 'тмц/заявка': ask} " data-item=" ask['$номенклатура'] " data-data=" $ctrl['номенклатура'] " data-on-select-item="$ctrl.OnSelectNomen(item, param)" data-on-focus-field000="$ctrl.FocusRow(row)" ></tree-item>
            
            <!--div ng-show=" ask['$номенклатура']['сохранить'] " class="right-align">
              <a ng-click="" href="javascript:" class="btn" ng-disabled="!$ctrl.ValidNomen(ask)">Сохранить</a>
            </div-->
            
            <table ng-if=" ask['@текущие остатки'] " class="z-depth-1 striped purple lighten-4"><!--{{ ask['@текущие остатки'] | json }}-->
              <thead>
                <tr>
                  <th>Найдены остатки</th>
                  <th>на складе</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="row in ask['@текущие остатки'] | orderBy: $ctrl.OrderByCurrentOstNomen">
                  <td>
                  <a ng-click="$ctrl.ClickOstNomen(row, ask)" href="javascript:" class="hover-shadow3d" title="{{ row['$номенклатура'] | json }}">
                    <span ng-if=" row['$номенклатура'] && row['$номенклатура'].parents_title && row['$номенклатура'].parents_title[0] " ng-repeat="n in row['$номенклатура'].parents_title" class="breadcrumb"><span class="">{{ n }}</span></span>
                    <span class="breadcrumb">{{ row['$номенклатура'].title }}</span>
                  </a>
                    
                  </td>
                  <td>
                    <span ng-repeat="ost in row['@остатки']"><a ng-init=" obj = $ctrl.MapObject(ost['объект/id'])" ng-click="$ctrl.ClickOstObject(ost, row, ask)" href="javascript:" class="btn purple bold" title="запросить на [{{ obj.name }}]"><span class="" >{{ ost['остаток'] }}</span></a> </span>
                  </td>
                </tr>
              </tbody>
            </table>
          
          </div>
        
          <div ng-if="ask._edit" class="absolute left-align" style="left: 0; /*top: 5rem;*/ z-index: 1; width:100%;">
            <tmc-ask-form data-param="$ctrl.param" data-data="ask"></tmc-ask-form>
          </div>
          
      </td>
      <td class="center left-align-000 bold fs14">
        <!--span class="nowrap">{{  parseFloat(Util.numeric(ask["количество"])).toLocaleString('ru-RU')  }}</span>
        <span ng-hide="!ask['тмц/количество']" class="nowrap">- {{  parseFloat(Util.numeric(ask["тмц/количество"])).toLocaleString('ru-RU')  }} = {{  (parseFloat(Util.numeric(ask["количество"])) - parseFloat(Util.numeric(ask["тмц/количество"]))).toLocaleString('ru-RU')  }}</span-->
        <div ng-if=" !ask['@тмц/строки простой поставки'].length " class="">
          <span ng-hide="!ask['заявка/количество/остаток'] || ask['заявка/количество/остаток'] == parseFloat(Util.numeric(ask['количество']))" class="bold">{{ ask['заявка/количество/остаток'].toLocaleString('ru-RU') }}</span>
          <span ng-class="{'grey-text fs8 chip': !!ask['заявка/количество/остаток'] && ask['заявка/количество/остаток'] != parseFloat(Util.numeric(ask['количество'])), 'bold': !ask['заявка/количество/остаток'] || ask['заявка/количество/остаток'] == parseFloat(Util.numeric(ask['количество']))}">{{ parseFloat(Util.numeric(ask['количество'])).toLocaleString('ru-RU') }}</span>
        </div>
        
        <div ng-if=" ask['@тмц/строки простой поставки'].length " class="">
          {{ parseFloat(Util.numeric(ask['количество'])).toLocaleString('ru-RU') }}
        </div>
        
      </td>
      <!--td>{{ask['ед']}}</td-->
      
      
      
      <td class="relative vtop">
        <!--textarea ng-hide="!ask['коммент']" ng-model="ask['коммент']" ng-disabled="true" class="materialize-textarea fs8" style="font-size:0.8rem; padding:0;"></textarea--->
        <div class="fs8 grey-text000">{{ ask['коммент'] }}</div>
        
        <div ng-if="$ctrl.param['объект'].id === 0">
          <h5 class="chip orange-text text-darken-4">
            <!--i class="icon icon-star fs10"></i-->
            <span>{{ask['объект']}}</span>
          </h5>
          <div class="chip padd-0-05 right">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="orange-fill-000-fill-darken-4"  style="height: 1rem;"><use xlink:href="/fonts/icons.svg#person" /></svg>
            <span class="orange-text-000-text-darken-4 fs8">{{ ask['$профиль заказчика'].names.join(' ') }}</span>
          </div>
        </div>
        
        <div class="fs7 grey-text " style="position:absolute; right:0; bottom:0;" title="ид заявки">#{{ ask.id }}</div>
      </td>
      
      <!-- крыжик в закупку -->
      <td ng-if="!!$ctrl.param['в закупку'] && !$ctrl.param['список простых закупок']"><!---  !ask['@тмц/строки простой поставки'].length -->
        <div class="input-field center">
          <input type="checkbox" ng-attr-id="{{ask.id}}" ng-model="ask['обработка']"  ng-change="$ctrl.Checked(ask)" ng0000-click="$ctrl." ng000-checked="!!row['']" ng000-disabled="!row['']">
          <label for="{{ask.id}}" ng-click="  $ctrl.Checked(ask, true) " class="chb-yellow-lighten-4 teal-text text-darken-3">&#8203;</label></label><!-- осторожно, тут пробел нулевлой ширины--->
        </div>
      </td>
      
      <!-- крыжик в простую поставку -->
      <td ng-if=" !!$ctrl.param['в закупку'] && !$ctrl.param['список простых закупок'] " ng-init=" easy = ask['$простая обработка заявки'] " ><!-- простая поставка -->
        <div class="input-field center">
          <input type="checkbox" ng-attr-id="chb-easy-{{ask.id}}" ng-model="easy._edit"  ng-change-000="$ctrl.CheckedEasy(ask)" ng0000-click="$ctrl." ng000-checked="!!row['']" ng000-disabled="!row['']">
          <label for="chb-easy-{{ask.id}}" ng-click="  $ctrl.CheckedEasy(ask, true) " class="chb-maroon-lighten-5 maroon-text text-darken-3" title="простая поставка без подтвердений">&#8203;</label></label><!-- осторожно, тут пробел нулевлой ширины--->
        </div>
        
        <!---строка  формы простой обработки -->
        <div ng-if="easy._edit" class="absolute" style="left: 0; /*top: 5rem;*/ z-index: 1; width:100%;">
          <tmc-snab-form-easy data-data=" easy "></tmc-snab-form-easy>
        </div>
        
      </td>
      
      <!-- крыжик в перемещение -->
      <!--td ng-if=" !!$ctrl.param['в перемещение'] && !$ctrl.param['список простых закупок'] ">
      <div class="input-field center">
          <input type="checkbox" ng-attr-id="chb-move-{{ask.id}}" ng-model="ask['в перемещение']"  ng-change="$ctrl.CheckedMove(ask)">
          <label for="chb-move-{{ask.id}}" ng-click="  $ctrl.CheckedMove(ask, true) " class="chb-red-lighten-3 red-text text-darken-4">&#8203;</label></label><!-- осторожно, тут пробел нулевлой ширины>
        </div>
      </td-->
      
      <!-- колонка отображения простой поставки -->
      <td ng-if="!!$ctrl.param['список простых закупок'] " ng-init=" easy = ask['$простая обработка заявки'] " class="vtop-000">
        <div ng-show="easy['$строка тмц/поставщик']['количество']">
          <h5 class="center000 maroon-text" title000="тмц #{{ easy['$строка тмц/поставщик'].id }}">
            <span  class="leaf maroon white-text left left-align fw500"><i class="icon-left fs10"></i> <span ng-if="easy['$строка тмц/поставщик']['$контрагент']"> {{ easy['$строка тмц/поставщик']['$контрагент'].title }}</span></span>
            <a ng-click=" easy._edit = !easy._edit " href="javascript:" class="hover-shadow3d chip shadow-inset-10 center bold maroon-text" style="min-width:3rem;" title="изменить простую поставку">{{ easy['$строка тмц/поставщик']['количество'] }}</a>
            <span class="nowrap clearfix">
              <span class="chip padd-0-05 fs8">{{ easy['$строка тмц/поставщик']['$ts']['день нед'] }} {{  easy['$строка тмц/поставщик']['$ts']['day'] }} {{ easy['$строка тмц/поставщик']['$ts']['мес'] }}</span>
              <span class="chip padd-0-05 fs8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="maroon-fill" style="height: 1rem;"><use xlink:href="/fonts/icons.svg#person"></use></svg> {{ easy['$строка тмц/поставщик']['$снабженец'].names.join(' ') }}</span>
              <span class="fs7 grey-text" style-0000="position:absolute; right:0; bottom:0;" title="{{ easy['$строка тмц/поставщик'] | json }}">#{{ easy['$строка тмц/поставщик'].id }}</span>
            </span>
          </h5>
        </div>
        
        <!--- база отдала на простой поставке--->
        <div ng-show="easy['$строка тмц/с базы']['количество']">
          <h5 class="center000 red-text text-darken-2" title000="тмц #{{ easy['$строка тмц/с базы'].id }}">
            <span class="leaf red darken-3 white-text left left-align fw500"><i class="icon-left fs10"></i> ★ {{ easy['$строка тмц/с базы']['$объект'].name }}</span>
            
            <a ng-click=" easy._edit = !easy._edit " href="javascript:" class="hover-shadow3d chip shadow-inset-10 bold red-text text-darken-2" style="min-width:3rem;"><i class="material-icons ">remove_circle_outline</i>{{ easy['$строка тмц/с базы']['количество'] }}</a>
            <span class="nowrap clearfix">
              <span class="chip padd-0-05 fs8">{{ easy['$строка тмц/с базы']['$ts']['день нед'] }} {{  easy['$строка тмц/с базы']['$ts']['day'] }} {{ easy['$строка тмц/с базы']['$ts']['мес'] }}</span>
              <span ng-show="!easy['$строка тмц/поставщик']['количество']" class="chip padd-0-05 fs8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="red-fill fill-darken-2" style="height: 1rem;"><use xlink:href="/fonts/icons.svg#person"></use></svg> {{ easy['$строка тмц/с базы']['$снабженец'].names.join(' ') }}</span>
              <span class="fs7 grey-text" style-0000="position:absolute; right:0; bottom:0;" title="{{ easy['$строка тмц/с базы'] | json }}">#{{ easy['$строка тмц/с базы'].id }}</span>
            </span>
          </h5>
        </div>
        
        <!--- база приняла на простой поставке--->
        <div ng-show="easy['$строка тмц/на базу']['количество']">
          <h5 class="center000 green-text text-darken-4" title="тмц #{{ easy['$строка тмц/на базу'].id }}">
            <span class="leaf green darken-4 white-text left left-align fw500"><i class="icon-left fs10 before-rotate90right"></i> ★ {{ easy['$строка тмц/на базу']['$объект'].name }}</span>
            
            <a ng-click=" easy._edit = !easy._edit " href="javascript:" class="hover-shadow3d chip shadow-inset-10 bold green-text text-darken-4" style="min-width:3rem;"><i class="material-icons ">add_circle_outline</i>{{ easy['$строка тмц/на базу']['количество'] }}</a>
            
            <span class="fs7 grey-text" style-0000="position:absolute; right:0; bottom:0;" title="{{ easy['$строка тмц/на базу'] | json }}">#{{ easy['$строка тмц/на базу'].id }}</span>
            
          </h5>
        </div>
        
        <!--div ng-if="!!$ctrl.param['в закупку']" class="center" ng-style=" easy._edit && {'visibility':'hidden'} ">
          <a class="btn-flat maroon-text" ng-click=" easy._edit = !easy._edit " href="javascript:" title="изменить простую поставку"><i class="icon icon-ok-circle"></i></a>
        </div-->
        
        
        
        <div ng-if="easy._edit" class="absolute" style="margin-top:2rem; left: 0; /*top: 5rem;*/ z-index: 1; width:100%;">
          <tmc-snab-form-easy data-data="easy"></tmc-snab-form-easy>
        </div>
        
      </td>
    </tr>
    
    <!--tr>
      <td colspan="{{$ctrl.param['объект'].id === 0 ? 7 : 6}}">
        <div class="center">
          <!--span>записей: {{ $ctrl.dat$ctrl.taba['заявки'].length }}</span->
          <a ng-show="$ctrl.data['заявки'].length >= 100" class="btn-flat" ng-click="$ctrl.LoadData(true)" href="javascript:">
            <svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" class="black-fill" style="height: 1.2rem;" ><use xlink:href="/fonts/icons.svg#download" /></svg>
            Показать еще
          </a>
        </div>
        <div ng-show="$ctrl.cancelerHttp" ng-include=" 'progress/load' "></div>
      </td>
    
    </tr-->
  
  </tbody>

</table>

</div>

<!-- Modal Structure -->
<div id="nomen-select" class="card modal" ng-if="$ctrl.param.where" style="height:100%;">
  <div class="modal-content input-field">
    <a ng-click="$ctrl.CancelWhere('наименование')" href="javascript:" class="right modal-action modal-close red-text btn-flat z-depth-1">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="red-fill fill-lighten-3" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#cancel"></use></svg>
      Отмена
    </a>
    <h2 class="">Фильтровать заявки по фрагменту строки наименования</h2>
    <input name="nomen-select" type="text" ng-model="$ctrl.param.where['наименование'].title" />
  </div>
  <div class="modal-footer">
    <a ng-click="$ctrl.SendWhere('наименование')" href="javascript:" class="modal-action modal-close  btn-flat z-depth-1 green-text">Готово</a>
  </div>
</div>