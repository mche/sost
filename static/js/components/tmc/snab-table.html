@@@ tmc/snab/table

<!--div ng-if=" $ctrl.ready && $ctrl.project !==  $ctrl.param['проект/id'] " ng-init="$ctrl.$onInit()" ng-show="0"></div><!---  Наблюдать для обновления контекста -->

<!--div>{{ $ctrl.param | json }}</div-->

<div ng-hide="$ctrl.ready" ng-include=" 'progress/load' "></div>

<!--ul ng-if="$ctrl.ready" class="tabs z-depth-1000 card000 tabs-transparent " style="margin:0;" ng-init="">
  <li ng-repeat="t in $ctrl.tabs" class="tab-overline z-depth-3 " ng-class="$ctrl.TabLiClass(t)" ng-style="t.liStyle" ng-attr-id000="" ng-hide000="!($ctrl.param['объект'] && $ctrl.param['объект'].id)">
    <h4><a ng-click="$ctrl.SelectTab($index)" href="javascript:" ng-class="$ctrl.TabAClass(t)" class="hvr-overline-from-center" title000="{000{t}}">
      <span>{{t.title}}</span>
      <sup class="chip middle black-text bold" style="/*padding: 0.2rem 0.5rem;	display: inline;*/">{{ t.len(t) }}</sup>
    </a></h4>
  </li>
</ul--->
<ul ng-if="$ctrl.ready" class="" style="margin:0;">
  <li ng-repeat="t1 in $ctrl.tabs | orderBy: $ctrl.OrderByTab1" class="" ng-class="{'right-align': $ctrl.tab && $ctrl.tab._parent && $ctrl.tab._parent !== t1, 'z-depth-3 grey lighten-2':  $ctrl.tab && $ctrl.tab._parent && $ctrl.tab._parent === t1,}" ng-style="$ctrl.tab && $ctrl.tab._parent && $ctrl.tab._parent === t1 && {'margin-top':'1rem'} ">
    <h3 class="iblock vtop z-depth-3000 right-align" ng-class="$ctrl.TabLiClass(t1)" style="height:50px; line-height:50px; padding:0 0.7rem; margin-right: -0.3rem; width:15rem;">
      <i ng-show=" t1.title == 'Закупка' "class="icon icon-star fs14"></i>
      <svg ng-show=" t1.title == 'Через базу' " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" ng-class="t1.svgClass" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#tracking" /></svg>
      <svg ng-show=" t1.title == 'Перемещение' "  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="rotate90left" ng-class="t1.svgClass" style="height: 1.5rem;" ><use xlink:href="/fonts/icons.svg#2arrows-180vert" /></svg>
      <span>{{ t1.title }}</span>
    </h3>
    <ul class="iblock vtop tabs tabs-transparent grey lighten-3" style="margin:0; width:auto;">
      <li ng-repeat="t2 in t1.childs" class="tab-overline z-depth-3 " ng-class="$ctrl.TabLiClass(t2)" ng-init="t2._parent = t1">
        <h4><a ng-click="$ctrl.SelectTab(t2)" href="javascript:" ng-class="$ctrl.TabAClass(t2)" class="hvr-overline-from-center">
          <svg ng-show=" t2.title == 'Заявки ТМЦ' " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" ng-class="t2.svgClass" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#!sign-round-fill" /></svg>
          <svg ng-show=" t2.title == 'в работе' " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="rotate90right" ng-class="t2.svgClass" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#process" /></svg>
          <svg ng-show=" t2.title == 'в перевозке' " xmlns="http://www.w3.org/2000/svg" viewBox="0 5 50 50" ng-class="t2.svgClass" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#truck" /></svg>
          <svg ng-show=" t2.title == 'завершено' " xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" ng-class="t2.svgClass" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#checked1" /></svg>
          <span>{{t2.title}}</span>
          <sup class="chip middle black-text bold" style="/*padding: 0.2rem 0.5rem;	display: inline;*/">{{ t2.len(t2) }}</sup>
        </a></h4>
      </li>
    
    </ul>
  </li>
</ul>
<!--div ng-if="$ctrl.ready && $ctrl.tab" ng-class="$ctrl.tab.liClass" class="divider" style="height:0.5rem; margin-bottom: 0.5rem;border-bottom: 3px dotted white;"></div-->

<!--- таблица для необработанных позиций -->
<!--div class="table-scroll-outer"><div class="table-scroll-inner"-->
<table ng-if="$ctrl.tab && $ctrl.tab.title == 'Заявки ТМЦ' " class="top000 striped bordered highlight z-depth-3">
  <thead class000="teal lighten-4" ng-class="$ctrl.tab.liClass">
    <tr><!--th>#</th-->
    <th class="center" style000="width:1%;">
      <h4>
        <a href="javascript:" data-target="date-select">
          <!--i class="material-icons">today</i-->
          <span>На дату</span>
        </a>
      </h4>
      <div ng-if="$ctrl.param.table['дата1'].ready">
       <span ng-repeat="v in $ctrl.param.table['дата1']['формат'] track by $index" class="breadcrumb00 chip green-text">{{v}}</span>
      </div>
    </th>
    
    <th ng-if="$ctrl.param['объект'].id === 0">
      <h4>На объект</h4>
    
    </th>
    
    <!--th ng-if="$ctrl.param.move.id === 0 || $ctrl.param.move.id == 1" ng-class="{'light-green lighten-4': $ctrl.param.move.id === 0}">
      <h4><a href="javascript:" data-target="contragent-select" class="green-text text-darken-2">
        <i class="material-icons">business</i>
        <span>Контрагент</span>
      </a></h4>
      <div ng-if="$ctrl.param.table['контрагент'].ready && $ctrl.param.table['контрагент'].id">
       <span class="chip green-text">{{$ctrl.param.table['контрагент'].title}}</span>
      </div>
      
    </th-->
    
    <th class="center" style="min-width:40%;">
      <h4><a href="javascript:" data-target="nomen-select" class000="green-text text-darken-2">
        <!--i class="material-icons">business</i-->
        <span>Наименование</span>
      </a></h4>
      <div ng-if="$ctrl.param.table['номенклатура'].ready && $ctrl.param.table['номенклатура'].id">
       <span class="chip green-text">{{$ctrl.param.table['номенклатура'].title}}</span>
      </div>
      
    </th>
    
    <th style="width:1%;">
      <h4>
        <!--i class="material-icons">more_horiz</i-->
        <span>Количество</span>
      </h4>
    </th>
    
    <!--th>
      <h4>
        <span>Ед</span>
      </h4>
    </th-->
    
    <th class="center" style="min-width:10%;">
      <h4>
        <!--i class="material-icons">message</i-->
        <span>Примечание</span>
      </h4>
    </th>
    <th class="center">
      <h4>В поставку</h4>
    </th>
    
    </tr>
  </thead>
  
  <tbody><!-- | filter: $ctrl.FilterData-->
    <tr ng-repeat="it in $ctrl.data['заявки'] | filter: $ctrl.tab['фильтр'] | orderBy: $ctrl.OrderByData : true" ng-init="$ctrl.InitRow(it)"  ng-attr-id="{{it.id}}"  class="waves-effect00 waves-teal00" ng-class="{'selected': it['обработка']}" style000="cursor:pointer;" title000="{000{it | json}}">
      <td class="right-align nowrap" title="{{ it['дата1 краткий формат'] || it['дата1'] }}">
        <span class="fs8"> {{ it['$дата1']['день нед'] }} </span>    <span class="bold"> {{ it['$дата1']['day'] }} </span>   <span class="fs8"> {{ it['$дата1']['мес'] }} </span>
        <span class="fs8 grey-text chip"><span class=""> {{ it['$ts']['день нед'] }} </span>    <span class=""> {{ it['$ts']['day'] }} </span>   <span class=""> {{ it['$ts']['мес'] }} </span></span>
      </td>
      <td ng-if="$ctrl.param['объект'].id === 0">
        <div>
          <i class="icon icon-star blue-text"></i>
          <span class="blue-text">{{it['объект']}}</span>
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="black-fill fill-darken-3"  style="height: 1.2rem;"><use xlink:href="/fonts/icons.svg#person" /></svg>
          <span ng-repeat="n in it['профиль заказчика'].names track by $index" class="black-text fs8">{{ n }}</span>
        </div>
      </td>
      <td class="right-align">
          <h5><span ng-repeat="n in it['номенклатура'] track by $index" class="breadcrumb teal-text"><span class="chip000 border000">{{n}}</span></span></h5>
          <div ng-class="{'fs8 grey-text': !!it['номенклатура/id'] }">{{ it['наименование'] }}</div><!-- временно вместо позиции номенклатуры -->
      </td>
      <td class="center">
        <!--span class="nowrap">{{  parseFloat(Util.numeric(it["количество"])).toLocaleString('ru-RU')  }}</span>
        <span ng-hide="!it['тмц/количество']" class="nowrap">- {{  parseFloat(Util.numeric(it["тмц/количество"])).toLocaleString('ru-RU')  }} = {{  (parseFloat(Util.numeric(it["количество"])) - parseFloat(Util.numeric(it["тмц/количество"]))).toLocaleString('ru-RU')  }}</span-->
        <span ng-hide="!it['тмц/количество']" class="bold">{{  (parseFloat(Util.numeric(it["количество"])) - parseFloat(Util.numeric(it["тмц/количество"]))).toLocaleString('ru-RU') }}</span>
        <span ng-class="{'grey-text fs8 chip': !!it['тмц/количество'], 'bold': !it['тмц/количество']}">{{ parseFloat(Util.numeric(it["количество"])).toLocaleString('ru-RU') }}</span>
        
      </td>
      <!--td>{{it['ед']}}</td-->
      <td>
        <textarea ng-model="it['коммент']" ng-disabled="true" class="materialize-textarea fs8" style="font-size:0.8rem; padding:0;"></textarea>
      </td>
      <td>
        <div class="input-field center" style000="height: 2.1rem; padding: 0.25rem 0rem;">
          <input type="checkbox" ng-attr-id="{{it.id}}" ng-model="it['обработка']"  ng-change="$ctrl.Checked(it)" ng0000-click="$ctrl." ng000-checked="!!row['']" ng000-disabled="!row['']">
          <label for="{{it.id}}" ng-click="  $ctrl.Checked(it, true) " class="chb-yellow-lighten-4 teal-text text-darken-3">&#8203;</label></label><!-- осторожно, тут пробел нулевлой ширины--->
        </div>
      </td>
    </tr>
    
    <tr>
      <td colspan="{{$ctrl.param['объект'].id === 0 ? 7 : 6}}">
        <div class="center">
          <!--span>записей: {{ $ctrl.data['заявки'].length }}</span-->
          <a ng-show="$ctrl.data['заявки'].length >= 100" class="btn-flat" ng-click="$ctrl.LoadData(true)" href="javascript:">
            <!--i class="material-icons">file_download</i-->
            <svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" class="black-fill" style="height: 1.2rem;" ><use xlink:href="/fonts/icons.svg#download" /></svg>
            Показать еще
          </a>
        </div>
        <div ng-show="$ctrl.cancelerHttp" ng-include=" 'progress/load' "></div>
      </td>
    
    </tr>
  
  </tbody>

</table>
<!--div>{{ $ctrl.dataOK | json }}</div-->
<!--/div></div-->

<tmc-ostat-table ng-if="$ctrl.ready" ng-show=" $ctrl.tab &&  $ctrl.tab.title == 'Остатки ТМЦ' " data-param="{'объект': $ctrl.param['объект'], tableClass: $ctrl.tab.liClass}" data-data="$ctrl.data['остатки']"></tmc-ostat-table><!--- остатки перед формой!--->

<tmc-snab-form data-param="param"></tmc-snab-form>

<tmc-snab-transport ng-if="$ctrl.tab && ($ctrl.tab.title == 'все' || $ctrl.tab.title == 'в работе' || $ctrl.tab.title == 'в перевозке' || $ctrl.tab.title == 'завершено')" data-param="{'объект': $ctrl.param['объект'], 'фильтр': $ctrl.tab['фильтр'], tableClass: $ctrl.tab.liClass }" data-data="$ctrl.data['снаб']" data-on-edit-ask="$ctrl.EditSnabAsk(ask)"></tmc-snab-transport>



<!--div class="pre-wrap">{{ $ctrl.data['остатки'] | json }}</div-->

<!-- Modal Structure -->
<div id="date-select" class="card modal" ng-if="$ctrl.param.table">
  <div class="modal-content">
    <h2 class="">Ограничить записи по датам</h2>
    <date-between data-param="$ctrl.param.table['дата1']"></date-between>
  </div>
  <div>{{$ctrl.param.table['дата1'] | json}}</div>
  <div class="modal-footer">
    <a ng-click="$ctrl.Cancel('дата1')" href="javascript:" class="modal-action modal-close  btn-flat">Отмена</a>
    <a ng-click="$ctrl.Send('дата1')" href="javascript:" class="modal-action modal-close  btn-flat teal-text">Готово</a>
    
  </div>
</div>

<!-- Modal Structure -->
<!--div id="sum-select" class="card modal" ng-if="$ctrl.param.table">
  <div class="modal-content">
    <h2 class="">Ограничить записи по сумме</h2>
    <div class="input-field">
      <h4>От</h4>
      <input type="text" class="" ng-model="$ctrl.param.table['сумма'].values[0]">
    </div>
    
    <div class="input-field">
      <h4>До</h4>
      <input type="text" class="" ng-model="$ctrl.param.table['сумма'].values[1]">
    </div>
  </div>
  <div class="modal-footer">
    <a ng-click="$ctrl.Cancel('сумма')" href="javascript:" class="modal-action modal-close  btn-flat">Отмена</a>
    <a ng-click="$ctrl.Send('сумма')" href="javascript:" class="modal-action modal-close  btn-flat teal-text">Готово</a>
    
  </div>
</div-->

<!-- Modal Structure -->
<div id="contragent-select" class="card modal" ng-if="$ctrl.param.table">
  <div class="modal-content">
    <h2 class="">Ограничить записи по контрагенту</h2>
    <contragent-item data-item="$ctrl.param.table['контрагент']"></contragent-item>
  </div>
  <div class="modal-footer">
    <a ng-click="$ctrl.Cancel('контрагент')" href="javascript:" class="modal-action modal-close  btn-flat">Отмена</a>
    <a ng-click="$ctrl.Send('контрагент')" href="javascript:" class="modal-action modal-close  btn-flat teal-text">Готово</a>
    
  </div>
</div>



