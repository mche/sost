
@@@ time/work/form

<div ng-hide="$ctrl.ready" ng-include=" 'progress/load' "></div>

<div ng-if="$ctrl.ready">

<div class="row">
<h2 class="col s12 m4 right-align" style="line-height:3rem;">
  <span style="vertical-align:text-top;">Табель</span>
  <div class="input-field inline picker-month">
    <input name="месяц" placeholder="месяц" type="text" class="datepicker bold input-hover"  ng-focus000="$ctrl.SetDate($event)" data-value="{{ $ctrl.param['месяц'] }}" style="margin:0rem; vertical-align:bottom;">
  </div>
</h2>

<!--ul ng-if="$ctrl.data['объекты']" class="tabs card tabs-transparent teal darken-2" style="margin:0;">
  <li ng-repeat="obj in $ctrl.data['объекты']" class="tab">
    <h3><a ng-click="$ctrl.SelectObj(obj)" href="javascript:" ng-class="{'active': obj === $ctrl.param['объект']}" style="font-size:inherit;">{{obj.name}}</a></h3>
  </li>
</ul-->

<div class="col s12 m8">
  <div ng-if00="$ctrl.data['объекты']" class="input-field000 col s12" style="">
    <object-my data-on-select-obj="$ctrl.OnSelectObj(obj)"></object-my>
  </div>
</div>
</div><!--row -->

<!--div>{{ $ctrl.data['значения'] | json }}</div-->
<div ng-show="$ctrl.cancelerHttp" ng-include=" 'progress/load' "></div>

<div ng-show000="$ctrl.param['объект']" class="right">
<a ng-click="$ctrl.Print()" href="javascript:" class="btn-flat black-text">
  <i class="material-icons">print</i>
  <span>Печать начисленных квитков</span>
</a></div>

<div class="horizontal-scroll">
<table ng-if="$ctrl.days && $ctrl.param['объект'] && $ctrl.data['сотрудники']" class="bordered timework card" ng-init000="$ctrl.InitTable()">
  <thead>
    <tr>
      <th></th>
      <th>ФИО</th>
      <th>Должность</th>
      <th ng-repeat="d in $ctrl.days" class="center" ng-class="{'yellow lighten-3': $ctrl.IsSunSat(d), 'orange-text': dateFns.isToday(d)}"><div ng-repeat="f in $ctrl.FormatThDay(d)">{{f}}</div></th>
      <th>Всего часов</th>
      <th>Всего смен</th>
      <th>Суточные</th>
      <th>КТУ</th>
      <th ng-if="$ctrl.param['замстрой']">КТУ зам. строй.</th>
      <th>Примечание</th>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="profile in $ctrl.data['сотрудники']" ng-init="$ctrl.InitRow(profile)">
      <td class="right" style="padding:0.1rem;">{{$index+1}}</td>
      <td>
        <a ng-hide="$ctrl.data['значения'][profile.id]._cnt" ng-click="$ctrl.HideProfile(profile, $index)" href="javascript:" class="right orange-text" title="убрать из списка"><i class="material-icons">cancel</i></a>
        <div class="truncate" style00="width:15rem;" title="{{profile.names.join(' ')}}"><h5 ng-repeat="n in profile.names track by $index" class="inline" style="padding: 0 0.3rem;">{{n}}</h5></div>
      </td>
      <td><span ng-repeat="d in profile['должности']" class="truncate fs8" style="padding: 0 0.3rem; width:7rem;" title="{{ d.name || d }}">{{d.name || d}}</span></td>
      
      <td ng-repeat="d in $ctrl.days" ng-init=" cell = $ctrl.InitCell(profile, d) " class="border data" ng-class="{'yellow lighten-3': $ctrl.IsSunSat(d), 'orange lighten-3':dateFns.isToday(d), 'grey lighten-2': dateFns.isFuture(d)}" title="{{cell._title}}" >
        <div class="input-field">
          <!--i ng-show="dateFns.isFuture(d)" class="material-icons grey-text fs20" style="position:absolute;">close</i-->
          <i ng-show="cell['коммент']" class="material-icons fs8 pink-text text-darken-4" style="position:absolute;right:0; margin: -1px;" title="{{ cell['коммент'] }}">error</i>
          <input type="text" class="" ng-focus="$ctrl.FocusInput(cell, $event)" ng-change="$ctrl.ChangeCell(cell, $event)" ng-model="cell['значение']" ng-disabled="$ctrl.DisabledCell(cell)" ng-dblclick000="$ctrl.ToggleDescr(cell)">
          <div ng-show="cell._editDescr" class="autocomplete-content dropdown-content card" style="position: absolute; z-index: 99999; width: 20rem; padding:0.5rem;">
            <h3 class="">Примечание</h3>
            <div class="input-field">
              <textarea ng-model="cell._editDescr['коммент']" class="materialize-textarea" style=""></textarea>
            </div>
            <div class="center">
              <a ng-click="$ctrl.SaveDesrc(cell)" ng-disabled="!cell._editDescr['коммент']" href="javascript:" class="btn-flat teal-text">ОК</a>
              <a ng-click="cell._editDescr = undefined" href="javascript:" class="btn-flat red-text">Отмена</a>
              
            </div>
          </div>
        </div>
        
      </td>
      <td class="total"><div ng-if=" $ctrl.Total(profile.id, true) " class="bold fs14">{{$ctrl.Total(profile.id)}}</div></td>
      <td class="total"><div ng-if=" $ctrl.Total(profile.id, true) " class="bold fs14">{{ $ctrl.data['значения'][profile.id]['всего смен'] }}</div></td>
      <td class="data" style="vertical-align:middle;"><!---  Суточные  -->
        <div class="input-field">
          <input type="checkbox" ng-attr-id="крыжик-суточные-{{profile.id}}" class="" ng-change="$ctrl.SaveRowValue(profile, 'Суточные')" ng-model="profile['Суточные']['коммент']" ng-disabled="$ctrl.Disabled(profile) ||  !!(profile['Суточные/начислено'] && profile['Суточные/начислено']['коммент'])" ng-true-value=" '1' "  style="height: auto;">
          <label for="крыжик-суточные-{{profile.id}}"></label>
        </div>
      </td>
      <td>
        <div class="input-field">
          <input type="text" class="" ng-focus="$ctrl.FocusKTU(profile, 'КТУ1', $event)" ng-change="$ctrl.SaveRowValue(profile, 'КТУ1')" ng-model="profile['КТУ1']['коммент']" ng-disabled="$ctrl.Disabled(profile, 'КТУ1')" placeholder="1.0" title="{{ profile._titleKTU }}">
        </div>
      </td>
      <!-- КТУ ставит замстрой -->
      <td ng-if="$ctrl.param['замстрой']">
        <div class="input-field">
          <input type="text" class="" ng-focus="$ctrl.FocusKTU(profile, 'КТУ2', $event)" ng-change="$ctrl.SaveRowValue(profile, 'КТУ2')" ng-model="profile['КТУ2']['коммент']" ng-disabled="$ctrl.Disabled(profile, 'КТУ2')" placeholder="{{profile['КТУ1']['коммент'] || '1,0'}}" title="{{ profile._titleKTU }}">
        </div>
      </td>
      <!-- Примечание общее -->
      <td>
        <div class="input-field">
          <textarea ng-model="profile['Примечание']['коммент']" ng-change="$ctrl.SaveRowValue(profile, 'Примечание')" class="materialize-textarea" style="padding: 0px; font-size: 0.8rem; border: none;"></textarea>
        </div>
      </td>
    </tr>
    <!--tr></tr-->
  </tbody>

</table>
</div>



<div ng-if="$ctrl.data['сотрудники'] && $ctrl.newProfiles && $ctrl.param['объект']" class="input-field">
  <input id="new-profile" ng-init="$ctrl.InitNewProfile()" type="text" class="" placeholder="добавить работника">
</div>



</div>