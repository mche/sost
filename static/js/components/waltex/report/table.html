
<div ng-hide="$ctrl.ready" ng-include=" 'progress/load' "></div>

<!--div>{{ $ctrl.data['строки'] | json }}</div-->

<table ng-if="$ctrl.ready" class="report bordered striped000 highlight" ng-class="{'report-vertical': $ctrl.IsVertTable()}">
  <thead>
    <tr>
      <th class="">

        <span ng-if="!$ctrl.IsVertTable() ">Движение / категории</span>
        <span ng-if=" $ctrl.IsVertTable() && !$ctrl.param['все кошельки'] && !$ctrl.param['все контрагенты'] && !$ctrl.param['все профили']">Интервалы / категории</span>
        <span ng-if=" $ctrl.IsVertTable() && $ctrl.param['все кошельки']">Кошельки / категории</span>
        <span ng-if=" $ctrl.IsVertTable() && $ctrl.param['все контрагенты']">Контрагенты / категории</span>
        <span ng-if=" $ctrl.IsVertTable() && $ctrl.param['все профили']">Сотрудники / категории</span>
      </th>
      <th  ng-if="$ctrl.IsVertTable()" class="right-align">
        <span class="">Остаток на начало {{ $ctrl.param['все контрагенты'] || $ctrl.param['все кошельки'] ? 'периода' : 'интервала'}}</span>
        <!---span class="chip">{{ $ctrl.param['дата']['формат'][0]}}</span--->
      </th>
      <th ng-repeat="th in $ctrl.data['колонки']" class="right-align">{{th.title}}</th>
        
      <th class="right-align">
        <!--div ng-if="!$ctrl.IsVertTable()">
          <span  class="">На 23:59:59 {{ $ctrl.param['дата']['формат'][1] }}</span>
          <span  class="right">Всего</span>
        </div>
        <div ng-if="$ctrl.IsVertTable()">
          <span>Всего</span>
          <span class="right">Сальдо {{$ctrl.param['все кошельки'] ? 'на '+$ctrl.param['дата']['формат'][1] : ''}}</span>
        </div-->
        <span  class="">Оборот за {{ $ctrl.param['все контрагенты'] || $ctrl.param['все кошельки'] || !$ctrl.IsVertTable() ? 'период' : 'интервал'}}</span>
      </th>
      <th class="">
        <span ng-if="$ctrl.IsVertTable()" class="right">Отстаток на конец {{ $ctrl.param['все контрагенты'] || $ctrl.param['все кошельки'] ? 'периода' : 'интервала'}}</span>
        <!--span class="chip">{{$ctrl.param['дата']['формат'][1]}}</span-->
      </th>
    
    </tr>
  </thead>
  <tbody>
    <!--- Строка сальдо на начало только для вертикальной таблицы --->
    <!---tr ng-if="$ctrl.IsVertTable() && $ctrl.data['сальдо']['начало']" class="lime lighten-3">
      <td>
      </td>
      <td>
        <span class="right bold" ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['начало'])">{{ $ctrl.data['сальдо']['начало'] }}</span>
      </td>
      <td ng-repeat="td in $ctrl.data['колонки']"></td>
      <td></td>
      <td class="right-align" ></td>
    </tr--->
    <tr ng-repeat="tr in $ctrl.data['строки']" ng-class="{'yellow lighten-3': !$ctrl.IsVertTable() && tr.sign < 0, 'green lighten-3': !$ctrl.IsVertTable() && tr.sign > 0}" ng-style="$ctrl.TrStyle(tr)">
      <td ng-style="$ctrl.TitleStyle(tr)">
        <h4 ng-if="tr.title"><a ng-click="$ctrl.ToggleRow(tr, $index)" href="javascript:" ng-class="{'orange-text text-darken-4': tr['колонки'] && !tr['колонки'].hasOwnProperty('-1') && tr.sign < 0}">
            <i class="material-icons">{{tr.expand ? 'keyboard_arrow_up' : 'keyboard_arrow_down'}}</i>
            <!--i class="material-icons" ng-if="tr.expand === true ">keyboard_arrow_up</i-->
            <span>{{$ctrl.TitleFormat(tr)}}</span>
            <i ng-if=" tr.title == 'приход' " class="material-icons">add_circle_outline</i>
            <i ng-if=" tr.title == 'расход' " class="material-icons">remove_circle_outline</i>
        </a></h4>
        <div ng-if="tr['категория']" class="right">
          <span ng-repeat="c in tr['категория'] track by $index" class="breadcrumb brown-text text-darken-2">{{c}}</span>
        </div>
      </td>
      <td ng-if="$ctrl.IsVertTable()"><!--- --->
        <span class="right bold" ng-class="$ctrl.PlusMinusClass(tr['сальдо1'])">{{ $ctrl.FormatMoney(tr['сальдо1']) }}</span>
      </td>
      <td ng-repeat="td in $ctrl.data['колонки']" ng-class="{'right-align': !tr['колонки'][td.key || td.title].id}" style="display: table-cell;" title="{{ tr['примечание'] }}">
        <span ng-if="!tr['колонки'][td.key || td.title].id">{{ $ctrl.FormatMoney(tr['колонки'][td.key || td.title]) }}</span>
        <!-- финальная позиция -->
        <div ng-if=" tr['колонки'][td.key || td.title].id" class="chip white right"  style="">
          <span class="right chip" style="padding-left:1rem;" ng-class000="{'orange-text text-darken-4': parseInt(tr.sign) < 0}">{{ tr['колонки'][td.key || td.title].sum }}</span>
          <a ng-click="$ctrl.ShowItem(tr['колонки'][td.key || td.title])" href="javascript:" class="fs8">
            <span>{{ tr['колонки'][td.key || td.title]['дата_формат'] }}</span>
            <!-- направление платежа -->
            <div ng-if="parseInt(td.sign || tr.sign) > 0 && !tr['профиль']" style="display: inline-block; vertical-align: top;">
              <div class="indigo-text text-darken-4" ng-if="!(tr['кошельки'][1] && tr['кошельки'][1][0])">{{tr['контрагент'] || '(пусто)'}} → </div>
              
              <div class="breadcrumb000 red-text text-darken-4">
                
                <span ng-if="tr['кошельки'][0] && tr['кошельки'][0][0]">{{tr['кошельки'][0][0]}}: {{tr['кошельки'][0][1]}}</span>
                <i class="material-icons" ng-if="tr['кошельки'][1] && tr['кошельки'][1][0]">swap_horiz</i>
                <span ng-if="tr['кошельки'][1] && tr['кошельки'][1][0]">{{tr['кошельки'][1][0]}}: {{tr['кошельки'][1][1]}}</span>
              </div>
            </div>
            <!-- направление платежа -->
            <div ng-if="parseInt(td.sign || tr.sign) < 0" style="display: inline-block; vertical-align: top;">
              <div class="breadcrumb000 red-text text-darken-4">
                
                <span ng-if="tr['кошельки'][0] && tr['кошельки'][0][0]">{{tr['кошельки'][0][0]}}: {{tr['кошельки'][0][1]}}</span>
                <i class="material-icons" ng-if="tr['кошельки'][1] && tr['кошельки'][1][0]">swap_horiz</i>
                <span ng-if="tr['кошельки'][1] && tr['кошельки'][1][0]">{{tr['кошельки'][1][0]}}: {{tr['кошельки'][1][1]}}</span>
              </div>
              
              <div class="indigo-text text-darken-4" ng-if="!(tr['кошельки'][1] && tr['кошельки'][1][0])"> → {{tr['контрагент'] || tr['профиль'] || '(пусто)'}}</div>
            </div>
            
            <!-- начисления из табеля -->
            <div ng-if="parseInt(td.sign || tr.sign) > 0 && tr['профиль']" style="display: inline-block; vertical-align: top;">
              <div class="breadcrumb000 red-text text-darken-4">Начислено по табелю</div>
              <div class="breadcrumb000 teal-text text-darken-4">{{ tr['кошельки'][0][1] }}</div>
              <div class="indigo-text text-darken-4"> → {{tr['профиль'] || '(пусто)'}}</div>
            </div>
            
          </a>
        </div>
      </td>
      <td>
        <span ng-if="!$ctrl.IsVertTable() && tr.level" class="right bold">{{ $ctrl.FormatMoney(tr['всего']) }}</span>
        <span ng-if="$ctrl.IsVertTable()" class="right bold" ng-class="$ctrl.PlusMinusClass(tr['всего'])">{{ $ctrl.FormatMoney(tr['всего']) }}</span>
      </td>
      <td>
        <span ng-if="$ctrl.IsVertTable()" class="right bold"  ng-class="$ctrl.PlusMinusClass(tr['сальдо2'])">{{ $ctrl.FormatMoney(tr['сальдо2']) }}</span>
        <span ng-if="!$ctrl.IsVertTable() && !tr.level" ng-class="$ctrl.PlusMinusClass(tr['всего'])" class="right bold">{{ $ctrl.FormatMoney(tr['всего']) }}</span>
      </td>
    </tr>
    
    <tr class="">
      <td class="right-align">
        <h4 ng-if="$ctrl.IsVertTable()" class="">Итого</h3>
        <!--span ng-if="!$ctrl.IsVertTable()" class="">Остатки</span-->
        
        <div ng-if="!$ctrl.IsVertTable()" class="chip white" style=""><!---  && !($ctrl.param['все контрагенты'] || $ctrl.param['все кошельки'])--->
          <span class="right bold chip" ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['начало'])">{{ $ctrl.FormatMoney($ctrl.data['сальдо']['начало']) || '0,00'}}</span>
          <span class="fs10">Общий остаток на {{$ctrl.param['дата']['формат'][0]}}</span>
        </div>
      </td>
      <td ng-if=" $ctrl.IsVertTable()" class="" >
        <div ng-if="$ctrl.data['сальдо'] && $ctrl.data['сальдо'].hasOwnProperty('начало')" class="chip white" style=""><!---  && !($ctrl.param['все контрагенты'] || $ctrl.param['все кошельки'])--->
          <span class="right bold chip" ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['начало'])">{{ $ctrl.FormatMoney($ctrl.data['сальдо']['начало']) || '0,00'}}</span>
          <span class="fs10">Общий остаток на {{$ctrl.param['дата']['формат'][0]}}</span>
        </div>
      </td>
      <td ng-repeat="td in $ctrl.data['колонки']" class="right-align">
        <span ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['колонки'][td.key || td.title])">{{ $ctrl.FormatMoney($ctrl.data['сальдо']['колонки'][td.key || td.title]) }}</span>
      </td>
      <!--td class="right-align"></td-->
      <td class="right-align">
        <span class="" ng-class="$ctrl.PlusMinusClass($ctrl.data['итого']['всего'])">{{ $ctrl.FormatMoney($ctrl.data['итого']['всего']) }}</span>
      </td>
      
      <td class="">
        <div ng-if="$ctrl.data['сальдо'] && $ctrl.data['сальдо'].hasOwnProperty('конец')" class="chip white" style="">
          <span  class="right bold chip" ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['конец'])">{{ $ctrl.FormatMoney($ctrl.data['сальдо']['конец']) }}</span>
          <span  class="fs10">Общий остаток на {{$ctrl.param['дата']['формат'][1]}}</span>
        </div>
      </td>
      
      <!--td>
        <div ng-if="!$ctrl.IsVertTable()">
          
          <span class="bold" ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['конец'])">{{$ctrl.data['сальдо']['конец']}}</span>
        </div>
        
        <div ng-if="$ctrl.IsVertTable()"> <!--- своп  ---
          <span class="right bold" ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['конец'])">{{$ctrl.data['сальдо']['конец']}}</span>
          <span class="" ng-class="$ctrl.PlusMinusClass($ctrl.data['итого']['всего'])">{{$ctrl.data['итого']['всего']}}</span>
          
        </div>
        
      </td-->
    
    </tr>
    
    <tr ng-if="0 && !$ctrl.IsVertTable() ">
      <td>
        <div class="chip white right" ng-show="$ctrl.data['сальдо']['начало']">
          <span  class="right bold chip" ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['начало'])">{{ $ctrl.FormatMoney($ctrl.data['сальдо']['начало']) }}</span>
          <span >Общий остаток на {{ $ctrl.param['дата']['формат'][0] }}</span>
        </div>
      </td>
      <td></td>
      <td ng-repeat="td in $ctrl.data['колонки']"></td>
      <td></td>
      <td>
        <div class="chip white right" ng-show="$ctrl.data['сальдо']['конец']">
          <span  class="right bold chip" ng-class="$ctrl.PlusMinusClass($ctrl.data['сальдо']['конец'])">{{ $ctrl.FormatMoney($ctrl.data['сальдо']['конец']) }}</span>
          <span >Общий остаток на {{ $ctrl.param['дата']['формат'][1] }}</span>
        </div>
      </td>
    </tr>
  
  </tbody>
</table>


 <!-- Modal Structure -->
<div ng-if="$ctrl.ready" id="show-item" class="card modal" style="width:100%;">
  <div class="modal-footer">
    <a href="javascript:" class="modal-action modal-close waves-effect waves-teal btn-flat">Закрыть</a>
  </div>
    <money-form ng-if="$ctrl.paramFormItem" data-param="$ctrl.paramFormItem" class="modal-content"></money-form>

</div>
