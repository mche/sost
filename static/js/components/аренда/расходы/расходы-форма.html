@@@ аренда/расходы/форма

<div><!-- обязательно один корень Vue -->
<v-progress-indeterminate v-show=" !ready " :color=" 'teal' " :message=" 'Загружается...' "></v-progress-indeterminate>

<div v-if="ready" class="card z-depth-5 teal lighten-4 animated zoomIn fast">

<!--div>{{ param }}</div-->

<div class="card-content">
  <div class="row relative">
    <a @click=" CancelBtn()" href="javascript:" class="btn-flat z-depth-1 white red-text lighten-2" style="position:absolute; right:0;">
      <i class="material-icons">cancel</i><span>Отмена</span>
    </a>
    <h3 class="fw500">
        <i v-show=" !form.id " class="material-icons ">folder_special</i>
        <span v-show=" !form.id " >Новый счет</span>
        
        <i v-show=" form.id " class="material-icons ">edit</i>
        <span v-show=" form.id " >Редактировать счет</span>
        
        <span v-show="form.id" class="grey-text fs8">#{{form.id}}</span>
        
      </h3>
      <div class="divider teal darken-4" style="margin-bottom: 1rem;"></div>
  
  </div>

  <div class="row" style="margin-bottom: 3rem;">
    <div class="col s2 ">
      <h4 class="right-align relative">
        <!--svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="teal-fill-darken-3" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#handshake"></use></svg-->
        <span>Дата счета</span>
      </h4>
    </div>
    <div class="col s4 m2 ">
      <div  key-000=" keys['дата'] "class="input-field">
        <!--a v-show="form['дата']" @click=" ClearDate('дата') " href="javascript:" class="" style="position:absolute; top:0; right:0; z-index:1;"><i class="material-icons red-text">cancel</i></a-->
        <!--h5 class="nowrap" style="position:absolute; top:-1.2rem;">
          <span>дата</span>
        </h5-->
        <input name="дата" type="text" class="datepicker"  :data-value=" form['дата'] " placeholder="дата счета">
      </div>
    </div>
  </div><!-- row -->
    
  <div class="row">
    <div class="col s2 ">
      <h4 class="right-align relative">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="teal-fill fill-darken-3" style="height: 1.5rem;"><use xlink:href="/fonts/icons.svg#contragent"></use></svg>
        <span>Арендатор и договор</span>
        <sup v-show=" !Valid('договор/id') " class="chip red white-text" style="position: absolute; z-index: 1; top:0;padding:0.3rem;"></sup>
      </h4>
    </div>
    <div class="col s10  row">
      <!--div class="border fs8">{{ form['контрагент'] }}</div-->
              <v-select :select=" {'id': form['договор/id'],} " :items=" contragentContracts " :param=" {placeholder: 'поиск арендатора', ulDropDownClass: ['striped blue lighten-4']} " @on-select=" OnContragentSelect ">
                <template v-slot:selected="{ selected }">
                  <h4 v-if="selected" class="relative padd-0-05 blue-text text-darken-4 animated fadeIn ">
                    
                    <span class="chip padd-0-05">{{ selected.$контрагент.title }}</span>
                    <span class="chip padd-0-05" title="объект и помещения">
                      <span><i class="material-icons ">place</i></span>
                      <span>{{ selected['@помещения'] && selected['@помещения'][0] && selected['@помещения'][0].$объект.name  }}</span>
                      <span class="fs10 padd-0-05">
                        <span>к./оф.: </span>
                        <span v-for="room in selected['@помещения']" :key="room.id"> {{ room.$помещение['номер-название'] }},</span>
                      </span>
                    </span>
                    <span class="chip padd-0-05" title="номер договора">
                      <!--svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="blue-fill-darken-3" style="height: 1rem;"><use xlink:href="/fonts/icons.svg#handshake"></use></svg-->
                      дог. № {{ selected['номер'].replace('№', '') }} от {{ selected['дата договора'] || selected['дата1'] }}
                    </span>
                    <!--span class="grey-text fs7" style="position:absolute; right:0; bottom:0;">#{{ selected.id }}</span-->
                  </h4>
                  <h5 v-else class="grey-text">Выбрать арендатора</h5>
                </template>
                
                <template v-slot:listItem="{ listItem, selected, highlighted }">
                  <h6 class="padd-0-05 blue-text text-darken-4 relative hover-shadow3d"  :class="{'bold fs12': listItem === selected, 'fw500': listItem === highlighted, 'nowrap': listItem !== selected}"  style="">
                    <span class="chip padd-0-05">{{ listItem.$контрагент.title }}</span>
                    <span class="chip padd-0-05" title="объект и помещения">
                      <span><i class="material-icons">place</i></span>
                      <span>{{ listItem['@помещения'] && listItem['@помещения'][0] && listItem['@помещения'][0].$объект.name  }}</span>
                      <span class="fs10 padd-0-05">
                        <span>к./оф.: </span>
                        <span v-for="room in listItem['@помещения']" :key="room.id"> {{ room.$помещение['номер-название'] }},</span>
                      </span>
                    </span>
                    <span class="chip padd-0-05" title="номер договора">дог. № {{ listItem['номер'].replace('№', '') }} от {{ listItem['дата договора'] || listItem['дата1'] }}</span>
                    <!--span class="grey-text fs7" style="position:absolute; right:0; bottom:0;">#{{ selected.id }}</span-->
                  </h6>
                </template>
              </v-select>
    </div>
  </div><!-- row -->

    
    <div class="row"><div class=" col s12 ">
      <h4 class="fw500 helmet tab-shadow active z-depth-1  lime lighten-4">
        <i class="material-icons">format_list_numbered</i>
        <span>Позиции счета</span>
        <sup class="chip ">{{ form['@позиции'].length-1 }}</sup>
      </h4>
    
      <table class="z-depth-1 bordered ">
        <tbody class="striped lime lighten-4">
          <tr v-for="(pos, idx) in form['@позиции']" :key=" pos._id ">
            <td class="right-align relative padd-05 vtop" style="width:1%;">
              {{idx+1}}
              <span v-if=" !!pos.id " class="fs7 grey-text" style="position: absolute; z-index: 1; bottom:0; left:0;">#{{ pos.id }}</span>
              <span v-else class="" :class="[ ValidPos(pos) ? 'lime-text-darken-4' : 'red-text-darken-3' ,]" style="position: absolute; z-index: 1; bottom:0; left:0;">✱</span>
              
            </td>
            <td class="relative padd-05 vtop">
              <!-- Номенклатура-->
              <v-suggest v-model.trim="pos['$номенклатура'].title" :item="pos" :items=" nomenData " :param="{placeholder: 'выбрать наименование или ввести новое', ulDropDownClass: ['striped teal lighten-4'],}" :onInputChange="OnNomenInput" :onItemSelect="OnNomenSelect">
                <template v-slot:item="{ item, idx, activeItem }">
                  <h5 class="relative hover-shadow3d"  :class="{'bold fs12': item.title == form.title, 'fw500': item === activeItem}"  style="">
                    <span>{{  item.title }}</span>
                  </h5>
                </template>
              </v-suggest>
              <span  v-show="!pos['$номенклатура'].id && pos['$номенклатура'].title.length > 0" class="chip red-text text-darken-3 fs8"  style="position: absolute;">* новое наименование *</span>
              <span  v-show="pos['$номенклатура'].id" class="grey-text fs7 " style="position: absolute; right:0.5rem;">#{{ pos['$номенклатура'].id }}</span>
            </td>
            <td class="padd-05" style="width:7rem;">
              <div class="input-field row" :class="{}">
                <input type="text" v-model.trim="pos['количество']"  @input="PosSum(pos)"placeholder="количество" class="right-align" title="количество" :disabled="!pos['$номенклатура'].title.length">
              </div>
            </td>
            
            <td class="padd-05" style="width:5rem;">
              <div class="input-field row" :class="{}">
                <input type="text" v-model.trim="pos['ед']" placeholder="ед. изм."  title="единицы измерения" :disabled="!pos['$номенклатура'].title.length">
              </div>
            </td>
            
            <td class="padd-05" style="width:7rem;">
              <div class="input-field row" :class="{}">
                <input type="text" v-model.trim="pos['цена']" @input="PosSum(pos)" class="right-align"  placeholder="цена, ₽"  title="цена, ₽" :disabled="!pos['$номенклатура'].title.length">
              </div>
            </td>
            
            <td class="padd-05" style="width:7rem;">
              <div class="input-field row" :class="{}">
                <input type="text" v-model.trim=" pos['сумма2'] " class="right-align" placeholder="сумма, ₽"  title="сумма, ₽" :disabled="!0">
              </div>
            </td>
            
            <td class="vtop" style="width:20%;">
              <div class="card padd-0-05 grey-lighten-3">
                <div class="input-field">
                  <textarea v-model.trim="pos['коммент']" class="materialize-textarea padd-0" style="min-height: 3rem; font-size:0.8rem;" placeholder="примечание"></textarea>
                </div>
              </div>
            </td>
          </tr>
          <!-- итогововая строка .replace(/[\.,]\d+$/, '')--->
          <tr>
            <td colspan=5></td>
            <td class="right-align">
              <h4>
                <span class="bold">{{ TotalSum.toLocaleString({"currency": 'RUB'}) }}</span>
                <span class=""> ₽</span>
              
              </h4>
            </td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div><!-- col -->
  </div><!-- row -->
  
   <!--div class="row">
    <div class="col s12 ">
      <h4 class="">
        <i class="material-icons">storage</i>
        <span>Файлы документов</span>
        <!--sup class="chip ">{{ form._uploads.length }}</sup>
      </h4>
      <div v-if="form.id" class="card teal lighten-5">
        <v-uploads :parent="form"></v-uploads>
      </div>
      <div v-else class="grey-text center">Можно загрузить после сохранения договора</div>
    </div>
   </div><!-- row -->
  
  <div class="row">
    <div class="col s12 ">
      <h4 class="">Примечание</h4>
    </div>
    <div class="col s12 ">
      <div class="card padd-05 grey-lighten-3 input-field">
        <textarea v-model.trim="form['коммент']" class="materialize-textarea padd-0 fs8" style="min-height: 4rem;"></textarea>
      </div>
    </div>
  </div><!-- row -->
  
</div><!-- card-content -->

<div class="pre-wrap">{{ form }}</div>

<div class="card-action center grey lighten-2">
  <v-progress-indeterminate v-show=" cancelerHttp " :color=" 'teal' " :message=" 'Сохраняется...' "></v-progress-indeterminate>
      <div v-show="!cancelerHttp">
        <a @click=" Save() " href="javascript:" :disabled="!Valid()" class="btn" >
          <i class="material-icons">save</i>
          <span>Сохранить</span>
        </a>
        <a @click=" CancelBtn() " href="javascript:" class="right btn-flat z-depth-1 red-text white">
          <svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="red-fill" style="height: 1.5rem;" ><use xlink:href="/fonts/icons.svg#cancel" /></svg>
          <span>Отмена</span>
        </a>
    </div>
</div>

</div>

</div>